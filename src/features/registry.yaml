# Feature Registry
# Automatically registers feature functions for the feature engineering pipeline
# Format: module.function_name -> feature_name

# Schema Version Control
schema_version: 2.0
feature_version: 2.0

# =============================================================================
# INTRINSIC TIME FEATURES
# =============================================================================
intrinsic_time:
  dc_return_x:
    module: intrinsic_time
    function: compute_dc_return
    description: "Directional-change return for threshold x"
    enabled: true
    params:
      delta: 0.0010
  
  overshoot_return_x:
    module: intrinsic_time
    function: compute_overshoot_return
    description: "Overshoot return after DC event"
    enabled: true
    params:
      delta: 0.0010
  
  overshoot_ratio_x:
    module: intrinsic_time
    function: compute_overshoot_ratio
    description: "Ratio of overshoot return to DC return"
    enabled: true
    depends_on:
      - dc_return_x
      - overshoot_return_x
    params:
      delta: 0.0010
  
  event_frequency:
    module: intrinsic_time
    function: compute_event_frequency
    description: "Number of DC events per unit time"
    enabled: true
    params:
      window: 24
  
  clustering:
    module: intrinsic_time
    function: compute_clustering
    description: "Temporal clustering of DC events"
    enabled: true
    params:
      window: 10
  
  multi_delta_agreement:
    module: intrinsic_time
    function: compute_multi_delta_agreement
    description: "Agreement across multiple delta thresholds"
    enabled: true
    params:
      deltas: [0.0005, 0.0010, 0.0020]
  
  intrinsic_trend_strength:
    module: intrinsic_time
    function: compute_intrinsic_trend_strength
    description: "Strength of trend in intrinsic time"
    enabled: true
    params:
      window: 20

# =============================================================================
# VOLATILITY FEATURES
# =============================================================================
volatility:
  realized_vol_5m:
    module: volatility
    function: compute_realized_volatility
    description: "Realized volatility (5-period window)"
    enabled: true
    params:
      window: 5
  
  realized_vol_15m:
    module: volatility
    function: compute_realized_volatility
    description: "Realized volatility (15-period window)"
    enabled: true
    params:
      window: 15
  
  realized_vol_60m:
    module: volatility
    function: compute_realized_volatility
    description: "Realized volatility (60-period window)"
    enabled: true
    params:
      window: 60
  
  bipower_variation:
    module: volatility
    function: compute_bipower_variation
    description: "Bipower variation (jump-robust volatility)"
    enabled: true
    params:
      window: 20
  
  jump_component:
    module: volatility
    function: compute_jump_component
    description: "Jump component of volatility"
    enabled: true
    depends_on:
      - realized_vol_15m
      - bipower_variation
    params:
      window: 20
  
  volatility_of_vol:
    module: volatility
    function: compute_volatility_of_volatility
    description: "Volatility of volatility"
    enabled: true
    depends_on:
      - realized_vol_15m
    params:
      window: 20
      vol_window: 10
  
  parkinson_volatility:
    module: volatility
    function: compute_parkinson_volatility
    description: "Parkinson volatility estimator"
    enabled: true
    params:
      window: 20
  
  skew:
    module: volatility
    function: compute_skew
    description: "Return skewness"
    enabled: true
    params:
      window: 20
  
  kurtosis:
    module: volatility
    function: compute_kurtosis
    description: "Return kurtosis"
    enabled: true
    params:
      window: 20
  
  variance_ratio:
    module: volatility
    function: compute_variance_ratio
    description: "Variance ratio test statistic"
    enabled: true
    params:
      short_window: 5
      long_window: 20
  
  hurst_exponent:
    module: volatility
    function: compute_hurst_exponent
    description: "Hurst exponent (long memory)"
    enabled: true
    params:
      window: 100

# =============================================================================
# MICROSTRUCTURE FEATURES
# =============================================================================
microstructure:
  micro_price:
    module: microstructure
    function: compute_micro_price
    description: "Microstructure price (bid-ask weighted)"
    enabled: true
    params: {}
  
  synthetic_spread:
    module: microstructure
    function: compute_synthetic_spread
    description: "Synthetic bid-ask spread"
    enabled: true
    params:
      window: 20
  
  relative_spread:
    module: microstructure
    function: compute_relative_spread
    description: "Relative spread (spread / mid price)"
    enabled: true
    params: {}
  
  wick_ratio:
    module: microstructure
    function: compute_wick_ratio
    description: "Upper wick to lower wick ratio"
    enabled: true
    params: {}
  
  body_ratio:
    module: microstructure
    function: compute_body_ratio
    description: "Body size to total range ratio"
    enabled: true
    params: {}
  
  rejection_wicks:
    module: microstructure
    function: compute_rejection_wicks
    description: "Rejection wick indicator"
    enabled: true
    params:
      threshold: 0.6
  
  standardized_range:
    module: microstructure
    function: compute_standardized_range
    description: "Range standardized by volatility"
    enabled: true
    params:
      window: 20
  
  volume_adv_ratio:
    module: microstructure
    function: compute_volume_adv_ratio
    description: "Volume to average daily volume ratio"
    enabled: true
    params:
      window: 20

# =============================================================================
# TREND FEATURES
# =============================================================================
trend:
  sma_ratio_10_20:
    module: trend
    function: compute_sma_ratio
    description: "SMA(10) / SMA(20) ratio"
    enabled: true
    params:
      short: 10
      long: 20
  
  ema_ratio_12_26:
    module: trend
    function: compute_ema_ratio
    description: "EMA(12) / EMA(26) ratio"
    enabled: true
    params:
      short: 12
      long: 26
  
  adx:
    module: trend
    function: compute_adx
    description: "Average Directional Index"
    enabled: true
    params:
      period: 14
  
  trend_strength:
    module: trend
    function: compute_trend_strength
    description: "Trend strength indicator"
    enabled: true
    params:
      window: 20
  
  price_position:
    module: trend
    function: compute_price_position
    description: "Price position in recent range"
    enabled: true
    params:
      window: 20

# =============================================================================
# FX FACTORS (UPDATED with external data)
# =============================================================================
fx_factors:
  carry_factor:
    module: fx_factors
    function: compute_carry_factor
    description: "Carry trade factor using real interest rate differentials from FRED"
    enabled: true
    params:
      use_external: true
  
  carry_raw:
    module: fx_factors
    function: compute_carry_raw
    description: "Raw interest rate differential (not normalized)"
    enabled: true
    params: {}
  
  momentum_factor:
    module: fx_factors
    function: compute_momentum_factor
    description: "Momentum factor (past return)"
    enabled: true
    params:
      window: 20
  
  value_factor:
    module: fx_factors
    function: compute_value_factor
    description: "Value factor (deviation from mean)"
    enabled: true
    params:
      window: 60
  
  volatility_factor:
    module: fx_factors
    function: compute_volatility_factor
    description: "Volatility factor (normalized volatility)"
    enabled: true
    params:
      window: 20
  
  yield_curve_factor:
    module: fx_factors
    function: compute_yield_curve_factor
    description: "US yield curve spread (10Y - 2Y) from FRED"
    enabled: true
    params: {}
  
  rate_level_factor:
    module: fx_factors
    function: compute_rate_level_factor
    description: "Absolute interest rate level"
    enabled: true
    params:
      currency: "USD"

# =============================================================================
# CROSS-ASSET FEATURES (UPDATED with Yahoo Finance data)
# =============================================================================
cross_asset:
  correlation_dxy:
    module: cross_asset
    function: compute_correlation_dxy
    description: "Rolling correlation with US Dollar Index"
    enabled: true
    params:
      window: 20
  
  correlation_spx:
    module: cross_asset
    function: compute_correlation_spx
    description: "Rolling correlation with S&P 500"
    enabled: true
    params:
      window: 20
  
  correlation_gold:
    module: cross_asset
    function: compute_correlation_gold
    description: "Rolling correlation with Gold"
    enabled: true
    params:
      window: 20
  
  correlation_vix:
    module: cross_asset
    function: compute_correlation_vix
    description: "Rolling correlation with VIX"
    enabled: true
    params:
      window: 20
  
  correlation_oil:
    module: cross_asset
    function: compute_correlation_oil
    description: "Rolling correlation with Oil"
    enabled: true
    params:
      window: 20
  
  relative_strength_vs_dxy:
    module: cross_asset
    function: compute_relative_strength_vs_dxy
    description: "Relative performance vs Dollar Index"
    enabled: true
    params:
      window: 20
  
  cross_asset_momentum:
    module: cross_asset
    function: compute_cross_asset_momentum
    description: "Aggregated cross-asset momentum signal"
    enabled: true
    params:
      window: 20
      assets: ["SPX", "GOLD"]
  
  risk_sentiment:
    module: cross_asset
    function: compute_risk_sentiment
    description: "Risk sentiment from SPX and VIX"
    enabled: true
    params:
      window: 20
  
  correlation_regime:
    module: cross_asset
    function: compute_correlation_regime
    description: "Average correlation level (high vs low correlation environment)"
    enabled: true
    params:
      window: 60

# =============================================================================
# SESSION FEATURES
# =============================================================================
session:
  london_session:
    module: session
    function: compute_london_session
    description: "London session indicator"
    enabled: true
    params: {}
  
  new_york_session:
    module: session
    function: compute_new_york_session
    description: "New York session indicator"
    enabled: true
    params: {}
  
  asia_session:
    module: session
    function: compute_asia_session
    description: "Asia session indicator"
    enabled: true
    params: {}
  
  session_overlap:
    module: session
    function: compute_session_overlap
    description: "Trading session overlap indicator"
    enabled: true
    params: {}
  
  session_volatility:
    module: session
    function: compute_session_volatility
    description: "Volatility by trading session"
    enabled: true
    params:
      window: 20

# =============================================================================
# LIQUIDITY FEATURES
# =============================================================================
liquidity:
  bid_ask_spread:
    module: liquidity
    function: compute_bid_ask_spread
    description: "Bid-ask spread"
    enabled: true
    params: {}
  
  spread_percentile:
    module: liquidity
    function: compute_spread_percentile
    description: "Spread percentile in recent distribution"
    enabled: true
    params:
      window: 100
  
  liquidity_score:
    module: liquidity
    function: compute_liquidity_score
    description: "Composite liquidity score"
    enabled: true
    params:
      window: 20

# =============================================================================
# TECHNICAL INDICATORS (NEW)
# =============================================================================
indicators:
  # RSI
  rsi:
    module: indicators
    function: compute_rsi
    description: "Relative Strength Index (0-100)"
    enabled: true
    params:
      window: 14
  
  rsi_normalized:
    module: indicators
    function: compute_rsi_normalized
    description: "Normalized RSI (-1 to 1)"
    enabled: true
    params:
      window: 14
  
  # MACD
  macd:
    module: indicators
    function: compute_macd
    description: "MACD line"
    enabled: true
    params:
      fast_period: 12
      slow_period: 26
      signal_period: 9
  
  macd_signal:
    module: indicators
    function: compute_macd_signal
    description: "MACD signal line"
    enabled: true
    params:
      fast_period: 12
      slow_period: 26
      signal_period: 9
  
  macd_histogram:
    module: indicators
    function: compute_macd_histogram
    description: "MACD histogram"
    enabled: true
    depends_on:
      - macd
      - macd_signal
    params:
      fast_period: 12
      slow_period: 26
      signal_period: 9
  
  # Stochastic
  stochastic_k:
    module: indicators
    function: compute_stochastic_k
    description: "Stochastic %K"
    enabled: true
    params:
      window: 14
  
  stochastic_d:
    module: indicators
    function: compute_stochastic_d
    description: "Stochastic %D"
    enabled: true
    depends_on:
      - stochastic_k
    params:
      window: 14
      smooth: 3
  
  stochastic_normalized:
    module: indicators
    function: compute_stochastic_normalized
    description: "Normalized Stochastic (-1 to 1)"
    enabled: true
    params:
      window: 14
      smooth: 3
  
  # CCI
  cci:
    module: indicators
    function: compute_cci
    description: "Commodity Channel Index"
    enabled: true
    params:
      window: 20
  
  cci_normalized:
    module: indicators
    function: compute_cci_normalized
    description: "Normalized CCI (-1 to 1)"
    enabled: true
    params:
      window: 20
  
  # Williams %R
  williams_r:
    module: indicators
    function: compute_williams_r
    description: "Williams %R"
    enabled: true
    params:
      window: 14
  
  williams_r_normalized:
    module: indicators
    function: compute_williams_r_normalized
    description: "Normalized Williams %R (-1 to 1)"
    enabled: true
    params:
      window: 14
  
  # ROC
  roc:
    module: indicators
    function: compute_roc
    description: "Rate of Change"
    enabled: true
    params:
      window: 12
  
  # ATR
  atr:
    module: indicators
    function: compute_atr
    description: "Average True Range"
    enabled: true
    params:
      window: 14
  
  atr_normalized:
    module: indicators
    function: compute_atr_normalized
    description: "ATR as percentage of price"
    enabled: true
    params:
      window: 14
  
  # OBV
  obv:
    module: indicators
    function: compute_obv
    description: "On-Balance Volume"
    enabled: true
    params: {}
  
  obv_normalized:
    module: indicators
    function: compute_obv_normalized
    description: "Normalized OBV (z-score)"
    enabled: true
    params:
      window: 20
  
  # MFI
  mfi:
    module: indicators
    function: compute_mfi
    description: "Money Flow Index"
    enabled: true
    params:
      window: 14
  
  mfi_normalized:
    module: indicators
    function: compute_mfi_normalized
    description: "Normalized MFI (-1 to 1)"
    enabled: true
    params:
      window: 14
  
  # Pivot Points
  pivot_point:
    module: indicators
    function: compute_pivot_point
    description: "Standard Pivot Point"
    enabled: true
    params: {}
  
  pivot_distance:
    module: indicators
    function: compute_pivot_distance
    description: "Distance from pivot point"
    enabled: true
    depends_on:
      - pivot_point
    params: {}
  
  # Bollinger
  bollinger_bandwidth:
    module: indicators
    function: compute_bollinger_bandwidth
    description: "Bollinger Band width"
    enabled: true
    params:
      window: 20
      num_std: 2.0
  
  bollinger_percent_b:
    module: indicators
    function: compute_bollinger_percent_b
    description: "Bollinger %B"
    enabled: true
    params:
      window: 20
      num_std: 2.0